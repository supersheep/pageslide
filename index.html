<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>try</title>
	<script type="text/javascript" src="js/mt-core.js"></script>
	<script type="text/javascript" src="js/mt-more.js"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css" media="all" />
</head>
<body>
	
	<div class="wrapper">
		<div class="status"></div>	
		<div class="board">		
			<div class="actionbar">
				<div class="action-btns">
					<a href="javascript:;" id="jAddRow">add a row</a>
					<a href="javascript:;" id="jSave">save</a>
				</div>
			</div>
			<div class="doc" id="doc">
			</div>	
			<div class="clear"></div>
		</div>
	
	</div>

	<!-- div class="drag"></div -->
	<script type="text/javascript">		
		
		Grid = new Class({
			elem:null,
			cls:'grid',
			initialize:function(cls){
				cls = cls||this.cls;
				this.elem = new Element('div',{'class':cls});
			}
		});
		
		Row = new Class({
			elem:null,
			cls:'row',	
			initialize:function(cls){
				cls = cls||this.cls;
				this.elem = new Element('div',{'class':cls});	
				this.addGrid();		
			},
			addGrid:function(){
				var grid=new Grid();
				grid.elem.inject(this.elem);
			}
		});
		
		Handler = new Class({
			initialize:function(elem,model){
				this.elem=elem;
				this.model=model;
				this.document=elem.getDocument();
				elem.addEvent('mousedown',this.start.bind(this));
			},
			start:function(event){
				this.prev=this.elem.getPrevious();
				this.next=this.elem.getNext();
				this.startpos=event.page;
				this.prev.size=this.prev.getSize();
				this.document.addEvent('mousemove',this.move.bind(this));
				this.document.addEvent('mouseup',this.end.bind(this));
			},
			move:function(event){
				if(this.model == 'v'){
					this.prev.setStyle('height',this.prev.size.y + event.page.y - this.startpos.y);
				}
			},
			end:function(event){
				this.document.removeEvents('mousemove');
				this.document.removeEvents('mouseup');
			}
		
		});
		
		
		Hhandler=new Class({
			elem:null,
			cls:'hhandler',
			initialize:function(cls){
				cls = cls||this.cls;
				this.elem = new Element('div',{'class':cls});
			}
		});
		
		Vhandler=new Class({
			elem:null,
			cls:'vhandler',
			initialize:function(cls){
				cls = cls||this.cls;
				this.elem = new Element('div',{'class':cls});
				new Handler(this.elem,'v');
			}			
		});
		
		
		Doc=new Class({
			elem:null,
			cls:'doc',
			initialize:function(cls){
				var cls = cls||this.cls;
				this.elem = $$('.'+cls)[0];	
			},
			addRow:function(){				
				var row = new Row();
				row.elem.inject(this.elem);
				var vhandler = new Vhandler();
				vhandler.elem.inject(this.elem);
			},	
			save:function(){}		
		})
		
		/**
		 * __Hook is an id
		 * __Class should be a css class
		 * __Selector should be a css selector
		**/		
		var cfg = {
			addRowHook:'jAddRow',
			saveHook:'jSave',
			gridClass:'grid'
		};
		
		
		/* init */
		(function (cfg){
			var doc = new Doc('doc');
			doc.addRow();
			$(cfg.addRowHook).addEvent('click',function(){
				doc.addRow();
			});
		})(cfg);
		
		//new Drag($$('.drag')[0],{limit:{x:[100,300],y:[120,120]}})
	</script>
</body>
</html>